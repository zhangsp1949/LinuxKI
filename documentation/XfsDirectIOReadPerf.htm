<html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=utf-8">
<meta name=Generator content="Microsoft Word 15 (filtered)">
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:8.0pt;
	margin-left:0in;
	line-height:107%;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{color:#954F72;
	text-decoration:underline;}
p
	{margin-right:0in;
	margin-left:0in;
	font-size:12.0pt;
	font-family:"Times New Roman",serif;}
.MsoChpDefault
	{font-family:"Calibri",sans-serif;}
.MsoPapDefault
	{margin-bottom:8.0pt;
	line-height:107%;}
@page WordSection1
	{size:8.5in 11.0in;
	margin:.5in .5in .5in .5in;}
div.WordSection1
	{page:WordSection1;}
-->
</style>

</head>

<body lang=EN-GB link=blue vlink="#954F72">

<div class=WordSection1>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;vertical-align:
top'><b><i><span lang=EN-US style='font-size:12.0pt;font-family:"Arial",sans-serif;
color:black'>LinuxKI Warning</span></i></b></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><b><span lang=EN-US style='font-size:10.0pt;
font-family:"Arial",sans-serif;color:black'>&nbsp;</span></b></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><b><span lang=EN-US style='font-size:10.0pt;
font-family:"Arial",sans-serif;color:black'>Poor Direct I/O&nbsp;read
performance using Oracle with XFS on RHEL 7.1</span></b></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:10.0pt;
font-family:"Arial",sans-serif;color:black'>Date: 03/01/2016</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:10.0pt;
font-family:"Arial",sans-serif;color:black'>&nbsp;</span></p>

<p class=MsoNormal style='line-height:11.25pt;vertical-align:top'><b><span
lang=EN-US style='font-size:10.0pt;font-family:"Arial",sans-serif;color:black'>Problem</span></b></p>

<p class=MsoNormal style='line-height:11.25pt;vertical-align:top'><span
lang=EN-US style='font-size:10.0pt;font-family:"Arial",sans-serif;color:black'>In
a TPCC benchmark test on a Superdome X running RHEL 7.1 with multiple Oracle
databases installed, two of the 8 databases were experiencing poor performance,
while the remain 6 were performing as expected.&nbsp;&nbsp; Looking at the AWR
Reports, the database reads were showing severe performance issues, even though
the data resided on the same 3PAR storage array.&nbsp;&nbsp; </span></p>

<p class=MsoNormal style='line-height:11.25pt;vertical-align:top'><b><span
lang=EN style='font-size:10.0pt;font-family:"Arial",sans-serif;color:black'>Top
10 Foreground Events by Total Wait Time</span></b></p>

<table class=MsoNormalTable border=0 cellpadding=0
 summary="This table displays top 10 wait events by total wait time" width=0
 style='width:6.25in'>
 <tr>
  <td style='background:#0066CC;padding:.75pt 3.0pt 1.5pt 3.0pt'>
  <p class=MsoNormal align=center style='margin-bottom:0in;margin-bottom:.0001pt;
  text-align:center;line-height:11.25pt;vertical-align:top'><b><span
  lang=EN-US style='font-size:8.0pt;font-family:"Arial",sans-serif;color:white'>Event</span></b></p>
  </td>
  <td style='background:#0066CC;padding:.75pt 3.0pt 1.5pt 3.0pt'>
  <p class=MsoNormal align=center style='margin-bottom:0in;margin-bottom:.0001pt;
  text-align:center;line-height:11.25pt;vertical-align:top'><b><span
  lang=EN-US style='font-size:8.0pt;font-family:"Arial",sans-serif;color:white'>Waits</span></b></p>
  </td>
  <td style='background:#0066CC;padding:.75pt 3.0pt 1.5pt 3.0pt'>
  <p class=MsoNormal align=center style='margin-bottom:0in;margin-bottom:.0001pt;
  text-align:center;line-height:11.25pt;vertical-align:top'><b><span
  lang=EN-US style='font-size:8.0pt;font-family:"Arial",sans-serif;color:white'>Total
  Wait Time (sec)</span></b></p>
  </td>
  <td style='background:#0066CC;padding:.75pt 3.0pt 1.5pt 3.0pt'>
  <p class=MsoNormal align=center style='margin-bottom:0in;margin-bottom:.0001pt;
  text-align:center;line-height:11.25pt;vertical-align:top'><b><span
  lang=EN-US style='font-size:8.0pt;font-family:"Arial",sans-serif;color:white'>Wait
  Avg(ms)</span></b></p>
  </td>
  <td style='background:#0066CC;padding:.75pt 3.0pt 1.5pt 3.0pt'>
  <p class=MsoNormal align=center style='margin-bottom:0in;margin-bottom:.0001pt;
  text-align:center;line-height:11.25pt;vertical-align:top'><b><span
  lang=EN-US style='font-size:8.0pt;font-family:"Arial",sans-serif;color:white'>%
  DB time</span></b></p>
  </td>
  <td style='background:#0066CC;padding:.75pt 3.0pt 1.5pt 3.0pt'>
  <p class=MsoNormal align=center style='margin-bottom:0in;margin-bottom:.0001pt;
  text-align:center;line-height:11.25pt;vertical-align:top'><b><span
  lang=EN-US style='font-size:8.0pt;font-family:"Arial",sans-serif;color:white'>Wait
  Class</span></b></p>
  </td>
 </tr>
 <tr>
  <td valign=top style='background:#FFFFCC;padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
  11.25pt;vertical-align:top'><span lang=EN-US style='font-size:8.0pt;
  font-family:"Arial",sans-serif;color:red'>db file scattered read</span></p>
  </td>
  <td valign=top style='background:#FFFFCC;padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal align=right style='margin-bottom:0in;margin-bottom:.0001pt;
  text-align:right;line-height:11.25pt;vertical-align:top'><span lang=EN-US
  style='font-size:8.0pt;font-family:"Arial",sans-serif;color:red'>126,247</span></p>
  </td>
  <td valign=top style='background:#FFFFCC;padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal align=right style='margin-bottom:0in;margin-bottom:.0001pt;
  text-align:right;line-height:11.25pt;vertical-align:top'><span lang=EN-US
  style='font-size:8.0pt;font-family:"Arial",sans-serif;color:red'>13.5K</span></p>
  </td>
  <td valign=top style='background:#FFFFCC;padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal align=right style='margin-bottom:0in;margin-bottom:.0001pt;
  text-align:right;line-height:11.25pt;vertical-align:top'><span lang=EN-US
  style='font-size:8.0pt;font-family:"Arial",sans-serif;color:red'>107.05</span></p>
  </td>
  <td valign=top style='background:#FFFFCC;padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal align=right style='margin-bottom:0in;margin-bottom:.0001pt;
  text-align:right;line-height:11.25pt;vertical-align:top'><span lang=EN-US
  style='font-size:8.0pt;font-family:"Arial",sans-serif;color:red'>48.0</span></p>
  </td>
  <td valign=top style='background:#FFFFCC;padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
  11.25pt;vertical-align:top'><span lang=EN-US style='font-size:8.0pt;
  font-family:"Arial",sans-serif;color:red'>User I/O</span></p>
  </td>
 </tr>
 <tr>
  <td valign=top style='background:white;padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
  11.25pt;vertical-align:top'><span lang=EN-US style='font-size:8.0pt;
  font-family:"Arial",sans-serif;color:red'>db file sequential read</span></p>
  </td>
  <td valign=top style='background:white;padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal align=right style='margin-bottom:0in;margin-bottom:.0001pt;
  text-align:right;line-height:11.25pt;vertical-align:top'><span lang=EN-US
  style='font-size:8.0pt;font-family:"Arial",sans-serif;color:red'>128,698</span></p>
  </td>
  <td valign=top style='background:white;padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal align=right style='margin-bottom:0in;margin-bottom:.0001pt;
  text-align:right;line-height:11.25pt;vertical-align:top'><span lang=EN-US
  style='font-size:8.0pt;font-family:"Arial",sans-serif;color:red'>13.5K</span></p>
  </td>
  <td valign=top style='background:white;padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal align=right style='margin-bottom:0in;margin-bottom:.0001pt;
  text-align:right;line-height:11.25pt;vertical-align:top'><span lang=EN-US
  style='font-size:8.0pt;font-family:"Arial",sans-serif;color:red'>104.90</span></p>
  </td>
  <td valign=top style='background:white;padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal align=right style='margin-bottom:0in;margin-bottom:.0001pt;
  text-align:right;line-height:11.25pt;vertical-align:top'><span lang=EN-US
  style='font-size:8.0pt;font-family:"Arial",sans-serif;color:red'>48.0</span></p>
  </td>
  <td valign=top style='background:white;padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
  11.25pt;vertical-align:top'><span lang=EN-US style='font-size:8.0pt;
  font-family:"Arial",sans-serif;color:red'>User I/O</span></p>
  </td>
 </tr>
 <tr>
  <td valign=top style='background:#FFFFCC;padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
  11.25pt;vertical-align:top'><span lang=EN-US style='font-size:8.0pt;
  font-family:"Arial",sans-serif;color:black'>enq: TX - row lock contention</span></p>
  </td>
  <td valign=top style='background:#FFFFCC;padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal align=right style='margin-bottom:0in;margin-bottom:.0001pt;
  text-align:right;line-height:11.25pt;vertical-align:top'><span lang=EN-US
  style='font-size:8.0pt;font-family:"Arial",sans-serif;color:black'>3,879</span></p>
  </td>
  <td valign=top style='background:#FFFFCC;padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal align=right style='margin-bottom:0in;margin-bottom:.0001pt;
  text-align:right;line-height:11.25pt;vertical-align:top'><span lang=EN-US
  style='font-size:8.0pt;font-family:"Arial",sans-serif;color:black'>869.1</span></p>
  </td>
  <td valign=top style='background:#FFFFCC;padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal align=right style='margin-bottom:0in;margin-bottom:.0001pt;
  text-align:right;line-height:11.25pt;vertical-align:top'><span lang=EN-US
  style='font-size:8.0pt;font-family:"Arial",sans-serif;color:black'>224.05</span></p>
  </td>
  <td valign=top style='background:#FFFFCC;padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal align=right style='margin-bottom:0in;margin-bottom:.0001pt;
  text-align:right;line-height:11.25pt;vertical-align:top'><span lang=EN-US
  style='font-size:8.0pt;font-family:"Arial",sans-serif;color:black'>3.1</span></p>
  </td>
  <td valign=top style='background:#FFFFCC;padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
  11.25pt;vertical-align:top'><span lang=EN-US style='font-size:8.0pt;
  font-family:"Arial",sans-serif;color:black'>Application</span></p>
  </td>
 </tr>
 <tr>
  <td valign=top style='background:white;padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
  11.25pt;vertical-align:top'><span lang=EN-US style='font-size:8.0pt;
  font-family:"Arial",sans-serif;color:black'>DB CPU</span></p>
  </td>
  <td valign=top style='background:white;padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal align=right style='margin-bottom:0in;margin-bottom:.0001pt;
  text-align:right;line-height:11.25pt;vertical-align:top'><span lang=EN-US
  style='font-size:8.0pt;font-family:"Arial",sans-serif;color:black'>&nbsp;</span></p>
  </td>
  <td valign=top style='background:white;padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal align=right style='margin-bottom:0in;margin-bottom:.0001pt;
  text-align:right;line-height:11.25pt;vertical-align:top'><span lang=EN-US
  style='font-size:8.0pt;font-family:"Arial",sans-serif;color:black'>322.3</span></p>
  </td>
  <td valign=top style='background:white;padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal align=right style='margin-bottom:0in;margin-bottom:.0001pt;
  text-align:right;line-height:11.25pt;vertical-align:top'><span lang=EN-US
  style='font-size:8.0pt;font-family:"Arial",sans-serif;color:black'>&nbsp;</span></p>
  </td>
  <td valign=top style='background:white;padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal align=right style='margin-bottom:0in;margin-bottom:.0001pt;
  text-align:right;line-height:11.25pt;vertical-align:top'><span lang=EN-US
  style='font-size:8.0pt;font-family:"Arial",sans-serif;color:black'>1.1</span></p>
  </td>
  <td valign=top style='background:white;padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
  11.25pt;vertical-align:top'><span lang=EN-US style='font-size:8.0pt;
  font-family:"Arial",sans-serif;color:black'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:10.0pt;
font-family:"Arial",sans-serif;color:black'>&nbsp;</span></p>

<p class=MsoNormal style='line-height:11.25pt;vertical-align:top'><span
lang=EN-US style='font-size:10.0pt;font-family:"Arial",sans-serif;color:black'>In
all database instances, the databases resided on XFS filesystems.</span></p>

<p class=MsoNormal style='line-height:11.25pt;vertical-align:top'><b><span
lang=EN-US style='font-size:10.0pt;font-family:"Arial",sans-serif;color:black'>Investigation</span></b></p>

<p class=MsoNormal style='line-height:11.25pt;vertical-align:top'><span
lang=EN-US style='font-size:10.0pt;font-family:"Arial",sans-serif;color:black'>The
LinuxKI Toolset was used to collect a 20 second KI dump of the
system.&nbsp;&nbsp; The File Activity Report (kifile.*.txt) showed a lot of
mutex contention on one of the database files:</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>device: 0x0fd00000 node: 1716550918
fstype:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; REG&nbsp; filename:&nbsp; /oracle_data/tpccdata.dbf<br>
System Call Name&nbsp;&nbsp;&nbsp;&nbsp; Count&nbsp;&nbsp;&nbsp;&nbsp;
Rate&nbsp;&nbsp;&nbsp;&nbsp; ElpTime&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Avg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Max&nbsp;&nbsp;&nbsp;
Errs&nbsp;&nbsp;&nbsp; AvSz&nbsp;&nbsp;&nbsp;&nbsp; KB/s<br>
readv&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
10485&nbsp;&nbsp;&nbsp; 524.2&nbsp; 910.428597&nbsp;&nbsp; 0.086832&nbsp;&nbsp;
0.393425&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp; 37954&nbsp; 19431.0<br>
   SLEEP&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
41089&nbsp;&nbsp; 2054.4&nbsp; 902.106968&nbsp;&nbsp; 0.021955<br>
&nbsp;&nbsp;    <span style='background:yellow'>Sleep
Func&nbsp;&nbsp;&nbsp;&nbsp;
10237&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
875.541484&nbsp;&nbsp; 0.085527&nbsp;&nbsp; 0.387676&nbsp;
__mutex_lock_slowpath</span></span></p>

<p class=MsoNormal style='line-height:11.25pt;vertical-align:top'><span
lang=EN-US style='font-size:9.0pt;font-family:"Courier New";color:black'>      Sleep
Func&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
9844&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
9.275561&nbsp;&nbsp; 0.000942&nbsp;&nbsp; 0.013671&nbsp; rwsem_down_read_failed<br>
      Sleep Func&nbsp;&nbsp;&nbsp;&nbsp;
10475&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
8.958206&nbsp;&nbsp; 0.000855&nbsp;&nbsp; 0.015064&nbsp;
rwsem_down_write_failed<br>
      Sleep Func&nbsp;&nbsp;&nbsp;&nbsp;
10485&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
8.331718&nbsp;&nbsp; 0.000795&nbsp;&nbsp; 0.011906&nbsp; do_blockdev_direct_IO<br>
&nbsp; &nbsp;RUNQ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
0.371456<br>
&nbsp;&nbsp;
CPU&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
7.459641<br>
pread64&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
8793&nbsp;&nbsp;&nbsp; 439.6&nbsp; 748.182554&nbsp;&nbsp; 0.085088&nbsp;&nbsp;
0.390384&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;
8192&nbsp;&nbsp; 3517.2<br>
&nbsp;&nbsp;
SLEEP&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
34473&nbsp;&nbsp; 1723.6&nbsp; 741.649100&nbsp;&nbsp; 0.021514<br>
<span style='background:white'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='background:yellow'>Sleep Func&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
8710&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
720.760638&nbsp;&nbsp; 0.082751&nbsp;&nbsp; 0.382259&nbsp;
__mutex_lock_slowpath<br>
</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Sleep Func&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
8168&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
7.578238&nbsp;&nbsp; 0.000928&nbsp;&nbsp; 0.014525&nbsp; rwsem_down_read_failed<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Sleep Func&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
8771&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
7.568110&nbsp;&nbsp; 0.000863&nbsp;&nbsp; 0.014681&nbsp;
rwsem_down_write_failed<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Sleep Func&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
8793&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
5.742113&nbsp;&nbsp; 0.000653&nbsp;&nbsp; 0.013306&nbsp; do_blockdev_direct_IO<br>
&nbsp;&nbsp; RUNQ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
0.307918<br>
&nbsp;&nbsp;
CPU&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
6.080786<br>
lseek&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
10531&nbsp;&nbsp;&nbsp; 526.5&nbsp;&nbsp;&nbsp; 0.010822&nbsp;&nbsp;
0.000001&nbsp;&nbsp; 0.000029&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0<br>
&nbsp;&nbsp;
RUNQ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
0.000003<br>
&nbsp;&nbsp;
CPU&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
0.000020&nbsp;</span></p>

<p class=MsoNormal style='line-height:11.25pt;vertical-align:top'><span
lang=EN-US style='font-size:10.0pt;font-family:"Arial",sans-serif;color:black'>Subsequent
analysis of one of the Oracle processes reading this file shows the top sleep stack
traces:</span></p>

<p class=MsoNormal style='line-height:11.25pt;vertical-align:top'><span
lang=EN-US style='font-size:9.0pt;font-family:"Courier New";color:black'>PID
295368&nbsp; oracleORCL<br>
&nbsp; PPID 255353&nbsp; bash</span></p>

<p class=MsoNormal style='line-height:11.25pt;vertical-align:top'><span
lang=EN-US style='font-size:9.0pt;font-family:"Courier New";color:black'>&nbsp;&nbsp;&nbsp;
********* SCHEDULER ACTIVITY REPORT ********<br>
&nbsp;&nbsp;&nbsp; RunTime&nbsp;&nbsp;&nbsp; :&nbsp; 0.761588&nbsp;
SysTime&nbsp;&nbsp; :&nbsp; 0.225303&nbsp;&nbsp; UserTime&nbsp;&nbsp; :&nbsp;
0.536284<br>
&nbsp;&nbsp;&nbsp; SleepTime&nbsp; : 19.006968&nbsp; Sleep Cnt
:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1268&nbsp;&nbsp; Wakeup Cnt
:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 751<br>
&nbsp;&nbsp;&nbsp; RunQTime&nbsp;&nbsp; :&nbsp; 0.006764&nbsp; Switch
Cnt:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1272&nbsp;&nbsp; PreemptCnt
:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4<br>
&nbsp;&nbsp;&nbsp; Last CPU&nbsp;&nbsp; :&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
252&nbsp; CPU Migrs :&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 63&nbsp;&nbsp;
NODE Migrs :&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0<br>
&nbsp;&nbsp;&nbsp; Policy&nbsp;&nbsp;&nbsp;&nbsp; : SCHED_NORMAL&nbsp;&nbsp;&nbsp;&nbsp;
vss :&nbsp; 44006798&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rss
:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 6492</span></p>

<p class=MsoNormal style='line-height:11.25pt;vertical-align:top'><span
lang=EN-US style='font-size:9.0pt;font-family:"Courier New";color:black'>...</span></p>

<p class=MsoNormal style='line-height:11.25pt;vertical-align:top'><span
lang=EN-US style='font-size:9.0pt;font-family:"Arial",sans-serif;color:black'><br>
</span><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
color:black'>&nbsp;&nbsp;&nbsp; Process Sleep stack traces (sort by % of total
wait time) - Top 20 stack traces<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; count&nbsp;&nbsp;&nbsp;
wpct&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; avg&nbsp;&nbsp; Stack trace<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
%&nbsp;&nbsp;&nbsp;&nbsp; msecs<br>
&nbsp;&nbsp;&nbsp; ===============================================================<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 80&nbsp;
43.68&nbsp;&nbsp; 103.783&nbsp;&nbsp; <span style='background:yellow'>__mutex_lock_slowpath&nbsp;
mutex_lock&nbsp; xfs_file_aio_read&nbsp; </span>do_sync_readv_writev&nbsp;
do_readv_writev&nbsp; vfs_readv&nbsp; sys_readv&nbsp; tracesys&nbsp; |&nbsp;
sstk&nbsp; ksfd_skgfqio&nbsp; ksfd_skgfrvio&nbsp; ksfd_vio&nbsp;
ksfdvread&nbsp; kcfrbd1&nbsp; kcbz_table_scan_read<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 41&nbsp;
18.58&nbsp;&nbsp;&nbsp; 86.132&nbsp;&nbsp; <span style='background:yellow'>__mutex_lock_slowpath&nbsp;
mutex_lock&nbsp; xfs_file_aio_read&nbsp; </span>do_sync_read&nbsp;
vfs_read&nbsp; sys_pread64&nbsp; tracesys&nbsp; |&nbsp; __pread_nocancel&nbsp;
ksfd_skgfqio&nbsp; ksfd_io&nbsp; ksfdread&nbsp; kcfrbd1&nbsp; kcbzib&nbsp;
kcbgtcr&nbsp; ktrgtc2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 29&nbsp;
11.60&nbsp;&nbsp;&nbsp; 75.996&nbsp;&nbsp; SYSC_semtimedop&nbsp;
sys_semtimedop&nbsp; tracesys&nbsp; |&nbsp; semop&nbsp; skgpwwait&nbsp;
ksliwat&nbsp; kslwaitctx&nbsp; ksqcmi&nbsp; ksqgtlctx&nbsp; ksqgelctx&nbsp;
ktuGetTxForXid&nbsp; ktcwit1&nbsp; kdddgb&nbsp; kdusru&nbsp; updrowFastPath<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 23&nbsp;&nbsp;
9.46&nbsp;&nbsp;&nbsp; 78.144&nbsp;&nbsp; <span style='background:yellow'>__mutex_lock_slowpath&nbsp;
mutex_lock&nbsp; xfs_file_aio_read&nbsp; </span>do_sync_read&nbsp;
vfs_read&nbsp; sys_pread64&nbsp; tracesys&nbsp; |&nbsp; __pread_nocancel&nbsp;
ksfd_skgfqio&nbsp; ksfd_io&nbsp; ksfdread&nbsp; kcfrbd1&nbsp; kcbzib&nbsp;
kcbgtcr&nbsp; ktrget2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 19&nbsp;&nbsp;
6.98&nbsp;&nbsp;&nbsp; 69.874&nbsp;&nbsp; <span style='background:yellow'>__mutex_lock_slowpath&nbsp;
mutex_lock&nbsp; xfs_file_aio_read&nbsp; </span>do_sync_read&nbsp;
vfs_read&nbsp; sys_pread64&nbsp; tracesys&nbsp; |&nbsp; __pread_nocancel&nbsp;
ksfd_skgfqio&nbsp; ksfd_io&nbsp; ksfdread&nbsp; kcfrbd1&nbsp; kcbzibmlt&nbsp;
kcbzib&nbsp; kcbgtcr</span></p>

<p class=MsoNormal style='line-height:11.25pt;vertical-align:top'><span
lang=EN-US style='font-size:10.0pt;font-family:"Arial",sans-serif;color:black'>Note
in the stack traces above, the mutex_lock() function is called from
xfs_file_aio_read().&nbsp;&nbsp;&nbsp; The nice thing about Linux is that the
source code is readily available.&nbsp;&nbsp; While viewing the source code can
be intimidating, it’s not always super difficult to understand what is going
on.&nbsp;&nbsp; Below is the RHEL 7.1 source code for xfs_file_aio_read() where
locking is performed:</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>0283&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
/*</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>0284&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
* Locking is a bit tricky here. If we take an exclusive lock</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>0285&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
* for direct IO, we effectively serialise all new concurrent</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>0286&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
* read IO to this file and block it behind IO that is currently in</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>0287&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
* progress because IO in progress holds the IO lock shared. We only</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>0288&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
* need to hold the lock exclusive to blow away the page cache, so</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>0289&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
* only take lock exclusively if the page cache needs invalidation.</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>0290&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
* This allows the normal direct IO case of no page cache pages to</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>0291&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
* proceeed concurrently without serialisation.</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>0292&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
*/</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>0293&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
xfs_rw_ilock(ip, XFS_IOLOCK_SHARED);</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>0294&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='background:yellow'>if ((ioflags &amp; IO_ISDIRECT) &amp;&amp; inode-&gt;i_mapping-&gt;nrpages)
{</span></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>0295&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
xfs_rw_iunlock(ip, XFS_IOLOCK_SHARED);</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>0296&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='background:yellow'>xfs_rw_ilock(ip, XFS_IOLOCK_EXCL);</span></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>0297 </span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>0298&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
if (inode-&gt;i_mapping-&gt;nrpages) {</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>0299&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
ret = filemap_write_and_wait_range(</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>0300&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
VFS_I(ip)-&gt;i_mapping,</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>0301&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
style='background:yellow'>pos, pos + size - 1</span>);</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>0302&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
if (ret) {</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>0303&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
xfs_rw_iunlock(ip, XFS_IOLOCK_EXCL);</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>0304&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
return ret;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>0305&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
}</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>0306 </span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>0307&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>0308&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
* Invalidate whole pages. This can return an error if</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>0309&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
* we fail to invalidate a page, but this should never</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>0310&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
* happen on XFS. Warn if it does fail.</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>0311&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>0312&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
ret = invalidate_inode_pages2_range(VFS_I(ip)-&gt;i_mapping,</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>0313&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='background:yellow'>pos &gt;&gt; PAGE_CACHE_SHIFT,</span></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>0314&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style='background:yellow'>(pos + size - 1) &gt;&gt; PAGE_CACHE_SHIFT</span>);</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>0315&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
WARN_ON_ONCE(ret);</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>0316&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
ret = 0;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>0317&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
}</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>0318&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
xfs_rw_ilock_demote(ip, XFS_IOLOCK_EXCL);</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>0319&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
}</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:10.0pt;
font-family:"Arial",sans-serif;color:black'>&nbsp;</span></p>

<p class=MsoNormal style='line-height:11.25pt;vertical-align:top'><span
lang=EN-US style='font-size:10.0pt;font-family:"Arial",sans-serif;color:black'>In
the above code, if the file access is direct (IO_ISDIRECT) and there are file
pages mapped into memory (inode-&gt;I_mapping-&gt;nrpages), then the shared
lock is dropped (XFS_IOLOCK_SHARED), and the exclusive lock is obtained
(XFS_IOLOCK_EXCL).&nbsp;&nbsp;&nbsp; Once the exclusive lock is obtained, then
the pages associated with the direct I/O are pushed out of the
cache.&nbsp;&nbsp; Note that all of the file pages are not flushed, just the
once that overlap the direct I/O.&nbsp;&nbsp; Eventually, if ALL the pages get
pushed out of the filecache, performance would return to normal.</span></p>

<p><strong><span lang=EN-US style='font-family:"Arial",sans-serif'>Linux
versions impacted</span></strong></p>

<p><span lang=EN-US style='font-size:10.0pt;font-family:"Arial",sans-serif'>In
Linux version 3.16 and earlier, when the cached pages were invalidated, they
were invalidated at the position of the Direct I/O until the end of the
file.&nbsp;&nbsp; With Linux version 3.17, only the overlapping pages were
flushed, so every time a new Direct I/O was done, only a small portion of the
pages in the cache were invalidated, so the exclusive lock had to be obtained
until the entire file was pushed out of the cache, which may never
happen.&nbsp; </span></p>

<p><span lang=EN-US style='font-size:10.0pt;font-family:"Arial",sans-serif'>In
Linux version 4.3,&nbsp;when the first Direct I/O is performed, the entire file
is forced out of the&nbsp;cache, thus avoiding the&nbsp;exclusive lock after
the first Direct I/O.&nbsp;&nbsp; </span></p>

<p><span lang=EN-US style='font-size:10.0pt;font-family:"Arial",sans-serif'>RHEL
7.1 followed the 3.17 behavior.&nbsp;&nbsp; See also&nbsp;<span
class=MsoHyperlink><span style='color:#0066CC'><a
href="http://oss.sgi.com/archives/xfs/2015-08/msg00296.html"><span
style='color:#0066CC'>http://oss.sgi.com/archives/xfs/2015-08/msg00296.html</span></a></span></span>.&nbsp;&nbsp;
RHEL 7.0 follows the 3.16 behavior and can still suffer from the same
issue.&nbsp;&nbsp; RHEL 7.2 follows the 4.3 behavior and does not observe the
same issue.</span></p>

<p><span lang=EN-US style='font-size:10.0pt;font-family:"Arial",sans-serif'>SLES
12 and earlier follows the 3.16 and earlier behavior.</span></p>

<p class=MsoNormal style='line-height:11.25pt;vertical-align:top'><b><span
lang=EN-US style='font-size:10.0pt;font-family:"Arial",sans-serif;color:black'>Workaround</span></b></p>

<p class=MsoNormal style='line-height:11.25pt;vertical-align:top'><span
lang=EN-US style='font-size:10.0pt;font-family:"Arial",sans-serif;color:black'>A
quick solution to push the database pages out of the cache is to drop all of
the file cache pages.&nbsp;&nbsp; </span></p>

<p class=MsoNormal style='margin-left:.5in;line-height:11.25pt;vertical-align:
top'><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
color:black'>$ echo 3 &gt; /proc/sys/vm/drop_caches</span></p>

<p class=MsoNormal style='line-height:11.25pt;vertical-align:top'><span
lang=EN-US style='font-size:10.0pt;font-family:"Arial",sans-serif;color:black'>While
this will resolve the problem with the Direct I/O performance, note that ALL
pages for every filesystem are pushed out of the cache.&nbsp; So if you have
some other files that perform cached access rather than direct I/O access,
removing those pages from the cache may have other impacts.</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;line-height:107%;
font-family:"Arial",sans-serif'>If you only want to impact the one filesystem
in question, you will need to stop the database, unmounts the filesystem, and
mount it again.</span></p>

<p><span lang=EN-US style='font-size:10.0pt;font-family:"Arial",sans-serif'>Another
workaround existed for Linux distributions that follow the 3.16 behavior (RHEL
7.0 and earlier, SLES 12 and earlier).&nbsp;&nbsp; Since the pages are flushed
from the position of the Direct I/O operation until the end of the
file,&nbsp;you can simply do a single Direct I/O read from the file at file
offset 0.&nbsp;&nbsp; For example:</span></p>

<p style='margin-left:.5in'><span lang=EN-US style='font-size:10.0pt;
font-family:"Courier New"'>$&nbsp;dd if=&lt;filename&gt; of=/dev/null bs=4k
count=1 iflag=direct</span></p>

<p><strong><span lang=EN-US>Solution</span></strong></p>

<p><span lang=EN-US style='font-size:10.0pt;font-family:"Arial",sans-serif'>To
resolve the problem, upgrade to RHEL 7.1 or to&nbsp;a Linux kernel based on
version 4.3 or later.</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;line-height:107%;
font-family:"Arial",sans-serif'>&nbsp;</span></p>

</div>

</body>

</html>
